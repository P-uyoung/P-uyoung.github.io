---
layout: single  
categories: Aivle
title:  "[KT AIVLE 4ê¸°] Django - í…œí”Œë¦¿ê³¼ Form"
toc: true
toc_sticky: true
author_profile: false
search: true
---

**ë°ì´í„° ì¡°ì‘ : ì¥ê³ ì‰˜, admin ê¸°ë³¸ì•± í˜ì´ì§€, <u>Formì„ ì´ìš©í•œ HTML í˜ì´ì§€(í…œí”Œë¦¿)</u>**

16ì£¼ì°¨ ì˜¤ì •ì„ ê°•ì‚¬ë‹˜ì˜ ì¥ê³  3ì¼ì°¨ ìˆ˜ì—… ì£¼ì œëŠ” "ì¥ê³  í…œí”Œë¦¿ê³¼ ì¥ê³  í¼ì´ë‹¤"

ì¥ê³  Formì€ ì•ì„œ ì–¸ê¸‰í–ˆë“¯ì´ Modelì„ í†µí•´ ë§Œë“¤ ìˆ˜ ìˆìœ¼ë©°,

ì´ëŠ” í…œí”Œë¦¿ì—ì„œ ë°ì´í„°ë¥¼ ì¡°ì‘í•˜ê¸° ìœ„í•œ ë„êµ¬ì´ë‹¤.

---

# ğŸ§© í…œí”Œë¦¿

ê·¸ë ‡ë‹¤ë©´ í…œí”Œë¦¿ì€ ë­˜ê¹Œ?

**HTMLì—ì„œ ë™ì ì¸ ë°ì´í„°ë¥¼ í‘œì‹œí•˜ê³  ë¡œì§ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë„ë¡ <u>íƒœê·¸ì™€ í•„í„°</u> ë¥¼ í¬í•¨í•˜ëŠ” HTMLì˜ í™•ì¥ ë¬¸ë²•ì´ë‹¤.**


## í…œí”Œë¦¿ í™˜ê²½ì„¤ì •

viewì—ì„œ html í˜ì´ì§€ ì‘ë‹µì„ ìš”ì²­í•˜ë©´, **html í˜ì´ì§€ë¥¼ rendering í•˜ê¸° ìœ„í•´ì„œ** í•´ë‹¹ html íŒŒì¼ì„ ì°¾ëŠ”ë‹¤.

íŒŒì¼ì„ ì°¾ëŠ” **<u>í´ë”</u> ìœ„ì¹˜** ëŠ” ë‘ êµ°ë°!

- íŒŒì¼ì‹œìŠ¤í…œ ë¡œë” (ìš°ì„  ì‘ë™)

- ì•±ë””ë ‰í„°ë¦¬ ë¡œë”

INSTALLED_APPS ë¦¬ìŠ¤íŠ¸ì— ë“±ë¡ëœ ê° ì•±ì˜ templates í´ë”ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì°¾ì•„ë‚˜ê°.

```python
"""mysite/settings.py"""

TEMPATES = [
    {
        'DIRS' : [BASE_DIR/'templates'],  # íŒŒì¼ì‹œìŠ¤í…œ ë¡œë”ê°€ ì°¾ìŒ
    }

]

INSTALLED_APPS = [                      # ì•±ë””ë ‰í„°ë¦¬ ë¡œë”ê°€ ì°¾ìŒ
    "django.contrib.admin",
    "django.contrib.auth",
    "django.contrib.contenttypes",
    "django.contrib.sessions",
    "django.contrib.messages",
    "django.contrib.staticfiles",
    "blog",    # ìƒˆë¡œ ë“±ë¡
    "book",
]
```

## ì¥ê³  í…œí”Œë¦¿ ë¬¸ë²•

### context

ë·°ì—ì„œ í…œí”Œë¦¿ìœ¼ë¡œ ì „ë‹¬í•˜ëŠ” key:value ë”•ì…”ë„ˆë¦¬ íƒ€ì…ì˜ ë°ì´í„°ì´ë‹¤.

```python
"""blog/views.py"""

# í”„ë¡œí•„ ë³´ê¸°
def profile(request):
    user = User.objects.first()
    return render(request, 'blog/profile.html', {'user': user})
```

User ëª¨ë¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ htmlì— ì „ë‹¬í•¨.

```html
<!-- blog/templates/blog/profile.html -->
{% raw %}
{% extends "layout.html" %}

{% block title %}profile{% endblock title %}

{% block content %}
    <h1> {{user}}'s Profile </h1>
    <ul>
        <li>ì´ë¦„:{{user}}</li>  <!-- __str__  ì¬ì •ì˜í–ˆìœ¼ë¯€ë¡œ -->
        <li>ì „í™”ë²ˆí˜¸:{{user.profile.phone_number}}</li>
        <li>ì£¼ì†Œ:{{phone.profile.address}}</li>
    </ul>
{% endblock content %}
{% endraw %}
```

**< ì‚¬ìš©í•œ í…œí”Œë¦¿ íƒœê·¸ >**

- ì¶œë ¥ : \{\{ \}\}

- forë¬¸

- ifë¬¸

- í…œí”Œë¦¿ ìƒì†

### í…œí”Œë¦¿ ìƒì†

- ë¶€ëª¨ í…œí”Œë¦¿ì—ì„œ

```html
<!-- templates/layout.html -->
{% raw %}
<html>
<head>
    <meta charset="utf-8" />
    <title>{% block title %}{% endblock %}</title>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
    <style>
        html {position: relative; min-height: 100%}
        body{margin-bottom: 60px}
        #page-footer{
            position: absolute;
            bottom: 0;
            width:100%;
            height: 60;
            line-height: 60px;
            background-color: #f5f5f5;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-default">
        <div class="container">
            <div id="navbar" class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li class="active"><a href="/blog/">Home</a></li>
                    <li><a href="#">About</a></li>
                    <li><a href="#">Contact</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="#">íšŒì› ê°€ì… </a> </li>
                    <li><a href="#">ë¡œê·¸ì¸</a></li>
                    <li><a href="/blog/profile/">í”„ë¡œí•„</a> </li> 
                    <li><a href="#">ë¡œê·¸ ì•„ì›ƒ</a></li>
                 </ul>
                </div>
        </div>
    </nav>
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                {% block content %}
                {% endblock %}
            </div>            
        </div>
    </div>

    <div id="page-footer">
        <div class="container">
            <p class="text-muted">
                Copyright Â© 2020 KINO Data Systems All Right Reserved
            </p>
        </div>
    </div>
</body>
</html>
{% endraw %}
```

- ìì‹ í…œí”Œë¦¿ì—ì„œ

```{% raw %}{% extends "layout.html" %}{% endraw %}``` extends íƒœê·¸ë¡œ ìƒì†í•˜ê³ ,

```{% raw %}{% block title %}{% endblock %}{% endraw %}```

```{% raw %}{% block content %}{% endblock %}{% endraw %}```

blockì— ìˆëŠ” titleê³¼ contentë¥¼ ì¬ì •ì˜í•´ì„œ ì‚¬ìš©í•œë‹¤.

```html
<!-- blog/templates/blog/list.html -->
{% raw %}
{% extends "layout.html" %}

{% block title %}Post ëª©ë¡ ë³´ê¸°{% endblock title %}

{% block content %}

    <h1>Post ëª©ë¡ ë³´ê¸°</h1>

    <form action="" method='get'>
        {% csrf_token %}
        ê²€ìƒ‰ì–´ : <input type="text" name= "keyword" value="{{q|default:''}}">  <!-- value, ê°’ì´ ì—†ìœ¼ë©´ ë¹ˆë¬¸ì ì‚¬ìš© -->
        <input type="submit" value="ê²€ìƒ‰">
    </form>

    {% for post in post_all %}
        <a href="/blog/{{post.id}}"> {{post.title}} </a><br>
    {% endfor %}

    <p>
        <!--(ìœ ì§€ë³´ìˆ˜ë¥¼ ìœ„í•´) URL Reserve ì‚¬ìš©í•˜ê¸°-->
        <!-- <a href="/blog/new">[ìƒˆ ê¸€ ì“°ê¸°]</a>-->
        <a href="{% url 'blog:create' %}">[ìƒˆ ê¸€ ì“°ê¸°]</a>
    </p>

{% endblock content %}
{% endraw %}
```

---

# ğŸ§© ì¥ê³  Form

ë°ì´í„° ì¶”ê°€, ìˆ˜ì •, ì‚­ì œë¥¼ í…œí”Œë¦¿ì—ì„œ í•˜ê¸° ìœ„í•œ ë„êµ¬ì´ë‹¤.

Form íƒœê·¸ë¡œ êµ¬ì„±ë˜ë©° í•˜ë‚˜ ì´ìƒì˜ ìœ„ì ¯ìœ¼ë¡œ êµ¬ì„±ëœë‹¤. (ìœ„ì ¯ì´ë€ ì˜ˆë¥¼ë“¤ì–´ ì¸í’‹ì°½ ê°™ì€ ê±°ë‹¤.)

html ì½”ë“œì— ìš°ë¦¬ê°€ ì§ì ‘ Form íƒœê·¸ë¥¼ ì¶”ê°€í•´ì„œ ë§Œë“¤ ìˆ˜ ìˆê³ , ì¥ê³  Formì„ ì´ìš©í•´ì„œ ìë™ìœ¼ë¡œ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

**Modelì´ ë°ì´í„°ë² ì´ìŠ¤ì™€ ë§¤í•‘ë˜ë©°, FORMì€ ì‚¬ìš©ìë¡œë¶€í„° ë°ì´í„°ë¥¼ ì…ë ¥**

## 1. ì§ì ‘ Form íƒœê·¸ ì¶”ê°€í•´ë³´ê¸°

```<form action="" method='get'>```

### Method : GETê³¼ POST

```html
<!-- blog/templates/blog/post_delete.html -->
{% raw %}
{% extends "layout.html" %}
{% block title %}Post ì‚­ì œ{% endblock %}
{% block content %}
    <h1> POST ì‚­ì œ</h1>
    {{post}}  ê¸€ì„ ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?

    <form action="" method="POST">
        {% csrf_token %}
        <input type="submit" value="ë„¤, ì‚­ì œí•©ë‹ˆë‹¤">
    </form>

    <a href="{% url 'blog:list'%}">ì•„ë‹ˆì˜¤, ì·¨ì†Œí•©ë‹ˆë‹¤</a>
    
{% endblock %}
{% endraw %}
```

```html
<!-- blog/templates/blog/list.html -->
{% raw %}
{% extends "layout.html" %}

{% block title %}Post ëª©ë¡ ë³´ê¸°{% endblock title %}

{% block content %}

    <h1>Post ëª©ë¡ ë³´ê¸°</h1>

    <form action="" method='get'>
        {% csrf_token %}
        ê²€ìƒ‰ì–´ : <input type="text" name= "keyword" value="{{q|default:''}}">  <!-- value, ê°’ì´ ì—†ìœ¼ë©´ ë¹ˆë¬¸ì ì‚¬ìš© -->
        <input type="submit" value="ê²€ìƒ‰">
    </form>

{% endblock content %}
{% endraw %}
```

ìš”ì²­ ì •ë³´ëŠ” *name=value&name=value&...* í˜•íƒœì˜ Query Stringì¸ë°,

ì´ë¥¼ headerì— í¬í•¨í•˜ì—¬ ì „ë‹¬í•˜ë©´ GET ë°©ì‹ì´ë‹¤. (default)

ì´ë¥¼ bodyì— í¬í•¨í•˜ì—¬ ì •ë‹¬í•˜ë©´ POST ë°©ì‹ì´ë‹¤.


### CSRF

CSRF (cross-site request forgery) ëŠ” í˜„ì¬ ìš”ì²­ì´ ìœ íš¨í•œì§€ ì—¬ë¶€ë§Œ íŒë‹¨í•œë‹¤.

CsrfViewMiddlewareê°€ 

- **GET ìš”ì²­ ì‹œ csrf token ë°œê¸‰**

- **POST ìš”ì²­ ì‹œ csrf token ì²´í¬**

- **token ì²´í¬ ì˜¤ë¥˜ ì‹œ 403 Forbidden ì‘ë‹µ**

<img src="/assets/images/2023-11-22-django/êµ¬ì¡°ë„.jpg">
<br>

## HttpRequest ì†ì„±ë“¤

í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ì „ì†¡ëœ ìš”ì²­ì •ë³´ë¥¼ ì²˜ë¦¬í•˜ëŠ” ê°ì²´ì´ë‹¤.

**Viewì˜ ì²«ë²ˆì§¸ ì¸ìë¡œ ì „ë‹¬ëœë‹¤.**

|ì†ì„±|ì„¤ëª…|
|---------------|-----------------|
|HttpRequest.path|ìš”ì²­ì •ë³´ì˜ uriì— í•´ë‹¹í•¨|
|HttpRequest.method|GETì¸ì§€ POSTì¸ì§€ì— ëŒ€í•œ ì •ë³´|
|HttpRequest.GET|name=value&name=value ìš”ì²­í˜•ì‹ì„ QueryDict ë°˜í™˜|
|HttpRequest.POST|(GETê³¼ ë™ì¼)|
|HttpRequest.FILES|MultiValueDict ë°˜í™˜|
|HttpRequest.META|í´ë¼ì´ì–¸íŠ¸ì˜ ì •ë³´ ì œê³µ|

<br>


## 2. ì¥ê³  Form í´ë˜ìŠ¤ ë§Œë“¤ê¸°

```{% raw %}{{ form.as_p }}{% endraw %}```

**ì¥ê³  Form í´ë˜ìŠ¤ ì§ì ‘ ë§Œë“¤ê¸°**

```python
""" /blog/forms.py """

from django import forms

class PostForm(forms.Form):
    title = forms.CharField(label='ì œëª©')
    body = forms.CharField(label='ë‚´ìš©', widget=forms.Textarea)
```

```python
""" /blog/views.py """
from .forms import PostForm

def post_create(request):
    if request.method == 'POST':
        pass
    
    else: 
        form = PostForm()
        return render(request, 'blog/post_form.html', {'form': form})
```


```html
<!-- blog/post_form.html -->
{% raw %}
<form action="/your-view/" method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <input type="submit" value="Submit">
</form>
{% endraw %}
```

< ì¥ê³  Form ë©”ì†Œë“œ >

Form í•„ë“œë¥¼ HTML ìœ„ì ¯ íƒœê·¸ë¡œ ë³€í™˜í•  ë•Œ,

|ë©”ì†Œë“œ|HTML íƒœê·¸ë¡œ ë³€í™˜|
|----|----------------|
|as_p()|\<p> íƒœê·¸ë¡œ ë¶„ë¦¬|
|as_ul()|\<li> íƒœê·¸ë¡œ ë¶„ë¦¬|
|as_table()|\<tr> íƒœê·¸ë¡œ ë¶„ë¦¬|

ì¥ê³  Form ë©”ì†Œë“œëŠ” ì‚¬ìš©í•  ë•Œ ê´„í˜¸ë¥¼ ì•ˆì“´ë‹¤.


### ì¥ê³  Formì˜ ê¸°ëŠ¥

1. ëª¨ë¸ í´ë˜ìŠ¤ì— ë§ê²Œ Form íƒœê·¸ ìƒì„±

2. Data ì²˜ë¦¬ ìš©ì´

3. ìœ íš¨ì„± ê²€ì‚¬

<img src="/assets/images/2023-11-22-django/êµ¬ì¡°ë„2.jpg">

```redirect(<html ê²½ë¡œ>)``` í˜¹ì€

```redirect(<ëª¨ë¸ ì¸ìŠ¤í„´ìŠ¤>)``` + Modelì˜ get_absolute_url() returnê°’

**<span style="color:#ff0000">ë’¤ì—ì„œ ë°°ìš¸ ì¥ê³  Viewì˜ CRUDê°€ Form ê¸°ë°˜ì´ë¯€ë¡œ ì•ìœ¼ë¡œ ë‚´ìš©ì˜ ì²˜ë¦¬ ë°©ì‹ì´ ì´ì™€ ê°™ë‹¤.</span>**

<br>

## 3. ModelForm ì‚¬ìš©

**Form í´ë˜ìŠ¤ ì§ì ‘ ë§Œë“¤ì§€ ë§ê³ , Model ê¸°ë°˜ìœ¼ë¡œ ì‰½ê²Œ ë§Œë“¤ì**

```python
from django import forms
from blog.models import Post

class PostModelForm(forms.ModelForm):
    class Meta:
        model = Post
        fields = ['title', 'body']  # ë˜ëŠ” '__all__'
```
```python
def post_create(request):
    if request.method == 'POST':
        form = PostModelForm(request.POST)  # ë°ì´í„° ë°”ì¸ë”©
        if form.is_valid(): # ë°”ì¸ë”© ëœ valueë“¤ì˜ ìœ íš¨ì„± ê²€ì¦
            form.save()  # ë°ì´í„° INSERT
            return redirect('blog:list')
    
    # GET ë°©ì‹ì¼ ë•Œ ì…ë ¥í˜ì´ì§€ Form ì œê³µ
    # [ë“±ë¡ ë²„íŠ¼]  
    else: 
        form = PostModelForm()
        return render(request, 'blog/post_form.html', {'form': form})
    

```

---

# ğŸ§© URL Reverse

**<span style="color:#ff0000">í…œí”Œë¦¿ì—ì„œ ê²½ë¡œ ì¤‘ë³µì„ ë§‰ê¸° ìœ„í•´ì„œ templates í´ë” ë°‘ì— ì•±ëª…ì˜ í´ë”ë¥¼ í•˜ë‚˜ ë” ë§Œë“  ê²ƒ ì²˜ëŸ¼,</span>**

**<span style="color:#ff0000">ìœ ì§€ ë³´ìˆ˜ ì¸¡ë©´ì—ì„œ urlì˜ ì¤‘ë³µì„ ë§‰ê¸° ìœ„í•´ì„œ urlì„ ì§ì ‘ ì£¼ì§€ ì•Šê³ , reverse í•˜ëŠ” ê¸°ëŠ¥ì´ë‹¤.</span>**

htmlì—ì„œ ì‚¬ìš©í•  ë•ŒëŠ” ```{% raw %}{% url ì•±ëª…:path %}{% endraw %}```

viewì—ì„œ ì‚¬ìš©í•  ë•ŒëŠ” ```reverse()```, ```resolve()``` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•œë‹¤.

```python
""" blog/urls.py """

app_name = 'blog'  # ì¶”ê°€

urlpatterns = [
    path('new/', views.post_create)  # ëŒ€ì‹ ì—
    path('new/', views.post_create, name='create') 
]
```

```html
<!-- í…œí”Œë¦¿ì—ì„œ -->
{% raw %}
<a href="/blog/new/">[ìƒˆ ê¸€ ì“°ê¸°]</a>  <!-- ëŒ€ì‹ ì— -->
<a href="{% url 'blog:create' %}">[ìƒˆ ê¸€ ì“°ê¸°]</a>
{% endraw %}
```

```python
"""blog/models.py"""

from django.urls.base import reverse

class Post(model.Model):
    body = models.TextField()
    title = models.CharField(max_length=200)

    def get_absolute_url(self):
        return reverse('blog:list')  # í˜¹ì€
        return resolve_url('blog:list')

"""blog/veiws.py"""
from django.shortcuts import render, get_object_or_404, redirect

def post_create(request):
    if request.method == 'POST':
        form = PostModelForm(request.POST)
        if form.is_valid(): 
            post = Post.objects.create(**form.cleaned_data)
            return redirect(post)  # ì—¬ê¸°ì„œ 'blog/list' urlë¡œ
    
    else: 
        form = PostModelForm()
        return render(request, 'blog/post_form.html', {'form': form})
```

---

# ì†Œê°

ì²˜ìŒì—ëŠ” íƒœê·¸ë¥¼ ì‚¬ìš©í•´ì„œ ì§ì ‘ ë§Œë“¤ì–´ë³´ê³ , ì¥ê³ ì—ì„œ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì„ í†µí•´ í¸í•˜ê²Œ ë§Œë“¤ì–´ë³´ëŠ” ìˆœì„œë¡œ ìˆ˜ì—…ì´ ì§„í–‰ë˜ì—ˆë‹¤.

ê°•ì‚¬ë‹˜ì´ 1ë¶„ë„ ì•ˆì‰¬ì‹œê³  ì§„ë„ë¥¼ ë¹¼ì…”ì„œ ì—„ì²­ ì§‘ì¤‘í•˜ëŠë¼ ì €ë… ì‹œê°„ì´ ë˜ë‹ˆê¹Œ ë¨¸ë¦¬ê°€ ì§€ëˆì§€ëˆí•œ ê²ƒ ê°™ë‹¤ ğŸ¤¯